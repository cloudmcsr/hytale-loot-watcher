    <!-- Help Modal -->
    <div id="help-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Loot Table Viewer</h2>
                <button class="modal-close" onclick="closeHelp()">×</button>
            </div>
            <div class="modal-body">
                <section class="help-section">
                    <h3>Quick Start</h3>
                    <ul class="help-list">
                        <li><strong>Browse:</strong> Click folders and files in the sidebar</li>
                        <li><strong>Search:</strong> Type prefab names or item IDs (auto-detects what you're searching for)</li>
                        <li><strong>Filter items:</strong> Use the search box inside each loot card</li>
                        <li><strong>Collapse sections:</strong> Click SELECTION/BUNDLE headers</li>
                        <li><strong>Copy coordinates:</strong> Click coordinate chips</li>
                    </ul>
                </section>

                <section class="help-section">
                    <h3>Understanding Loot Tables</h3>
                    <table class="help-table">
                        <tr><th>Type</th><th>Description</th></tr>
                        <tr><td><code>SELECTION (Pick N)</code></td><td>Randomly selects N items from the pool</td></tr>
                        <tr><td><code>BUNDLE (All)</code></td><td>Guarantees all items in the section</td></tr>
                        <tr><td><code>Included: [Table]</code></td><td>References another loot table</td></tr>
                        <tr><td>Yellow badges</td><td>Drop chance percentage</td></tr>
                    </table>
                </section>

                <section class="help-section">
                    <h3>Generating Data for Other Versions</h3>
                    <p class="help-desc">If you have a different Hytale version or custom data, use the included Python script to generate a compatible JSON file.</p>
                    
                    <h4>Step 1: Configure Paths</h4>
                    <p class="help-desc">Edit these variables at the top of <code>structure_chests.py</code>:</p>
                    <pre class="code-block"><code>DROP_TABLES_DIR = Path("./Drops/Prefabs")    # Path to your loot tables
PREFABS_ROOT_DIR = Path("./Prefabs")         # Path to your prefab files
OUTPUT_FILE = "mapped_prefabs_data.json"     # Output filename</code></pre>

                    <h4>Step 2: Run the Script</h4>
                    <pre class="code-block"><code>python structure_chests.py</code></pre>

                    <h4>Step 3: Load the Data</h4>
                    <p class="help-desc">Drag and drop the generated JSON file into this viewer, or convert it to <code>data.js</code> format by prepending <code>window.DEFAULT_DATA = </code> to the file content.</p>

                    <h4>Python Script</h4>
                    <p class="help-desc"><code>structure_chests.py</code> - Click to expand/collapse:</p>
                    <div class="code-collapse">
                        <button class="code-toggle" onclick="togglePythonCode()">Show Full Source ▼</button>
                        <pre class="code-block code-full hidden" id="python-code"><code>import json
import os
from pathlib import Path

# --- CONFIGURATION ---
DROP_TABLES_DIR = Path("./Drops/Prefabs")
PREFABS_ROOT_DIR = Path("./Prefabs")
OUTPUT_FILE = "mapped_prefabs_data.json"

def load_loot_tables(directory):
    """Loads all JSON files in the drop tables directory."""
    loot_map = {}
    if not directory.exists():
        print(f"Warning: Loot directory {directory} not found.")
        return loot_map
    
    for file_path in directory.rglob("*.json"):
        try:
            with open(file_path, 'r', encoding='utf-8') as f:
                loot_map[file_path.stem] = json.load(f)
        except Exception as e:
            print(f"Error loading {file_path}: {e}")
    return loot_map

def process_prefabs(prefabs_dir, loot_tables):
    results = []
    used_loot_ids = set()
    
    for file_path in prefabs_dir.rglob("*.json"):
        try:
            with open(file_path, 'r', encoding='utf-8') as f:
                data = json.load(f)
        except:
            continue
        
        blocks = data.get("blocks")
        if not isinstance(blocks, list):
            continue
        
        rel_path = file_path.relative_to(prefabs_dir)
        prefab_info = {
            "structure_name": rel_path.parts[0] if len(rel_path.parts) > 1 else "Root",
            "prefab_name": file_path.name,
            "relative_path_from_root": str(rel_path),
            "total_chests": 0,
            "chests": []
        }
        
        for block in blocks:
            if block.get("name") == "Block_Spawner_Block":
                components = block.get("components", {}).get("Components", {})
                tier_id = components.get("BlockSpawner", {}).get("BlockSpawnerId")
                
                if tier_id:
                    used_loot_ids.add(tier_id)
                    chest_entry = {
                        "location": {"x": block["x"], "y": block["y"], "z": block["z"]},
                        "loot_table_id": tier_id
                    }
                    prefab_info["chests"].append(chest_entry)
                    prefab_info["total_chests"] += 1
        
        if prefab_info["total_chests"] > 0:
            results.append(prefab_info)
    
    return results, used_loot_ids

def main():
    print("Loading loot tables...")
    all_loot_tables = load_loot_tables(DROP_TABLES_DIR)
    
    print("Processing prefabs...")
    prefabs_data, used_loot_ids = process_prefabs(PREFABS_ROOT_DIR, all_loot_tables)
    
    filtered_loot_definitions = {
        tid: all_loot_tables[tid] for tid in used_loot_ids if tid in all_loot_tables
    }
    
    output_payload = {
        "loot_table_definitions": filtered_loot_definitions,
        "prefabs": prefabs_data
    }
    
    print(f"Saving to {OUTPUT_FILE}...")
    with open(OUTPUT_FILE, 'w', encoding='utf-8') as f:
        json.dump(output_payload, f, indent=2)
    
    print(f"Success! {len(prefabs_data)} prefabs, {len(filtered_loot_definitions)} tables.")

if __name__ == "__main__":
    main()</code></pre>
                    </div>
                </section>

                <section class="help-section">
                    <h3>Tips & Tricks</h3>
                    <ul class="help-list">
                        <li>Hover over item icons for detailed tooltips</li>
                        <li>Tier breakdown shown in stats: <code>T1: 5 | T3: 2</code></li>
                        <li>Missing icons show "?" placeholder</li>
                        <li>Run <code>showMissingIconsReport()</code> in browser console for icon diagnostics</li>
                        <li>Press <kbd>Esc</kbd> to close help</li>
                    </ul>
                </section>
            </div>
        </div>
    </div>
